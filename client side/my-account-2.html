<!doctype html>
<html class="no-js" lang="en">


<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>My Account</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Favicon -->
    <link rel="shortcut icon" type="image/x-icon" href="assets/images/favicon.ico">
    
    <!-- CSS 
    ========================= -->
   
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="assets/css/bootstrap.min.css">
    
    <!-- Fonts CSS -->
    <link rel="stylesheet" href="assets/css/material-design-iconic-font.min.css">
    
    <!-- Plugins CSS -->
    <link rel="stylesheet" href="assets/css/plugins.css">
    
    <!-- Main Style CSS -->
    <link rel="stylesheet" href="assets/css/style.css">
    
    <!-- Modernizer JS -->
    <script src="assets/js/vendor/modernizr-3.6.0.min.js"></script>
</head>

<body class="bg-black">

<!-- Main Wrapper Start -->
<div class="main-wrapper">
    <header class="header-area bg-black section-padding-lr">
        <div class="container-fluid">
            <div class="header-wrap header-netflix-style">
                <div class="logo-menu-wrap">
                    <!-- Logo -->
                    <div class="logo">
                        <a href="mainpage.html"><img src="assets/images/logo/logo.jpeg" alt=""></a>
                    </div>
                    <!-- Logo -->
                    <div class="main-menu main-theme-color-four">
                        <nav class="main-navigation">
                            <ul>
                                <li class="active"><a href="mainpage.html">Home</a></li>
                                <li><a href="Artists.html">Artists</a>
                                <li><a href="songs.html">Songs</a>
                                <li><a href="additions.html">Additions</a>
                                </li>
                            </ul>
                        </nav>
                    </div>
                </div>
                <div class="right-side d-flex">
                    <!-- our-profile-area start -->
                    <div class="our-profile-area ">
                        <a href="#" class="our-profile-pc" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            <img class="profile-imgg" id="userimg" src="assets/images/review/author-01.png" alt="">
                        </a>
                        <div class="dropdown-menu netflix-profile-style red">
                            <ul>
                                <li class="single-list"><a href="Favourite.html">Favourite List</a></li>
                                <li class="single-list"><a href="my-account-2.html">My Account</a></li>
                                <li class="single-list"><a href="login-and-register-2.html" id="logout-link">Log Out</a></li>

                            </ul>
                        </div>
                    </div>
                    <!-- mobile-menu start -->
                    <div class="mobile-menu d-block d-lg-none"></div>
                    <!-- mobile-menu end -->
                </div>
            </div>
        </div>
    </header>

   
    <!-- Page Conttent -->
    <main class="my-account-wrapper section-pt-90 section-pb-90 bg-black">
        <div class="container">
            <div class="col-md-12 col-lg-12">
                <!-- Nav tabs -->
                <ul role="tablist" class="nav dashboard-list white mb--60">
                    <li class="active" role="presentation"><a href="#account-details" data-bs-toggle="tab" class="tablist-btn active">Account details</a></li>
                </ul>
            </div>
            
            <div class="tab-content dashboard-content">
                <div class="tab-pane active" id="account-details">
                    <div class="row">

                        <div class="col-lg-9 col-xl-10 col-md-9">
                            <div class="account-form-container-wrapper our-product-left_m">
                                <div class="login">
                                    <div class="account-form-container">
                                        <div class="account-login-form">
                                            <form action="#">
                                                <div class="my-account-form-wrap border-bottom-2 white pb--30">
                                                    <h3>Change your general information.</h3>
                                                    <p id="userdate"></p>
                                                    <div class="row account-input-box">
                                                        <div class="col-md-6 single-input-box">
                                                            <label>Name</label>
                                                            <input type="text" name="first-name">
                                                        </div>
                                                        <div class="col-md-6 single-input-box">
                                                            <label>Phone Number</label>
                                                            <input type="text" name="phoneNumber">
                                                        </div>
                                                        <div class="col-md-6 single-input-box mt--15">
                                                            <label>Profile Photo</label>
                                                            <input type="text" value="" name="img_url">
                                                        </div>
                                                        <div class="col-md-6 single-input-box mt--15">
                                                            <label>Email Address</label>
                                                            <input type="email" name="email-name" value="">
                                                        </div>
                                                        <div class="col-md-6 single-input-box mt--15">
                                                            <label>Password</label>
                                                            <input type="Password" name="user-password" value="">
                                                        </div>
                                                    </div>
                                                </div>
                                                <button type="submit" class="button-box mt--30">Save Changes</button>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
        </div>
    </main>    
    <!--// Footer Area -->
    <!-- Modal -->
</div>
<!-- Main Wrapper End -->

<!-- JS
============================================ -->

<!-- jquery -->		
<script src="assets/js/vendor/jquery-3.5.1.min.js"></script>
<script src="assets/js/vendor/jquery-migrate-3.3.0.min.js"></script>
<!-- Popper JS -->
<script src="assets/js/popper.min.js"></script>
<!-- Bootstrap JS -->
<script src="assets/js/bootstrap.min.js"></script>
<!-- Plugins JS -->
<script src="assets/js/plugins.js"></script>
<!-- Ajax Mail -->
<script src="assets/js/ajax-mail.js"></script>
<!-- Main JS -->
<script src="assets/js/main.js"></script>
<script src="assets/js/ajaxCalls.js"></script>
<script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>


<script>

            const user = JSON.parse(localStorage.getItem('user'));
            if (user) {
                showUserInfo(user);
            }

            function showUserInfo(user) {
                const avatarImg = document.getElementById('userimg');
                avatarImg.src = user.img_url;
            }



            function logout() {
            localStorage.removeItem('user');
            window.location.href = `index.html`
            }
            const logoutLink = document.getElementById("logout-link");
            logoutLink.addEventListener("click", function(event) {
            event.preventDefault();
            logout(); 
            });


            $(document).ready(function () {
            $("form").on("submit", updateAccountDetails);
            $("[name='first-name'], [name='phoneNumber'], [name='email-name']").on("blur", checkNotEmpty);
            $("[name='user-password']").on("blur", checkPassword);
            let date = new Date(user.register_date);
            let options = { weekday: 'short', day: 'numeric', month: 'short', year: 'numeric' };
            let formattedDate = new Intl.DateTimeFormat('en-US', options).format(date);

            $('#userdate').text("User created at " + formattedDate);

});

    function checkNotEmpty() {
        if (this.value === "") {
            this.setCustomValidity('This field cannot be left blank');
        } else {
            this.setCustomValidity('');
        }
    }

    function checkPassword() {
        if (this.value.length < 8) {
            this.setCustomValidity('Password must contain at least 8 characters');
        } else {
            this.setCustomValidity('');
        }
    }

function updateAccountDetails(event) {
    event.preventDefault();
 
    let accountDetails = {
        id:user.id,
        email: $("[name='email-name']").val()=== "" ? user.email: $("[name='email-name']").val(),
        password: $("[name='user-password']").val()=== "" ?user.password: $("[name='user-password']").val(),
        phoneNumber: $("[name='phoneNumber']").val()=== ""?user.phoneNumber: $("[name='phoneNumber']").val(),
        img_url: $("[name='img_url']").val() === "" ? "https://cdn.discordapp.com/attachments/930951760372203580/1098335145334947900/default-avatar-profile-vector-user-profile-default-avatar-profile-vector-user-profile-profile-179376714.png" : $("[name='img_url']").val(),
        isadmin:user.isadmin,
        Name: $("[name='first-name']").val()=== "" ?user.name: $("[name='first-name']").val()
    };
    console.log(user.email);
    console.log(accountDetails);
    ajaxCall("POST", "https://proj.ruppin.ac.il/cgroup21/test2/tar1/api/User/UpdateUserDetails?oldemail="+user.email,JSON.stringify(accountDetails), success, error);
    function success(data) {
                console.log(data)
                if(data != 0){
                    swal("Account details updated!", "For security reasons we going to sign you out from all devices", "success");
                    setTimeout(function() {
                        logout()
                    }, 5000);
                }else{swal("Email Already in Use!", "try login using this email", "error");}
                
        }

       
         function error(err) {
            swal("Error", "Something went wrong", "error");
         }


    console.log(accountDetails);
    return false;
}











</script>

</body>
</html>